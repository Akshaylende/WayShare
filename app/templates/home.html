
{% extends 'template.html' %}

{% block content%}
<div class="b4">

    <div class="container4">

        <!-- Header -->
        <header class="summary-header">
            <div class="summary-title">
                {% if user['name'] %}
                <h1>Hello, {{user['name'].split(' ')[0]}}! ðŸ‘‹</h1>
                {% else %}
                <h1>Hello ! ðŸ‘‹</h1>
                {% endif %}
                <p>Here's the summary of you with us.</p>
            </div>
            <div class="header-actions">
                <a href="{{url_for('avail_rides')}}" class="btn btn-outline">Find a Ride</a>
                <a href="{{url_for('share_a_ride')}}" class="btn btn-primary">+ Post a Ride</a>
            </div>
        </header>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid">

            <!-- === LEFT COLUMN (Main Activity) === -->
            <div class="dash-left">

                <!-- 1. Stats Overview -->
                <div class="stats-overview">
                    <div class="overview-card">
                        <div class="overview-icon icon-rides"><i class="fas fa-car"></i></div>
                        <div class="overview-info">
                            <h3>{{data['total_rides']}}</h3>
                            <p>Total Rides</p>
                        </div>
                    </div>
                    <div class="overview-card">
                        <div class="overview-icon icon-earnings"><i class="fas fa-dollar-sign"></i></div>
                        <div class="overview-info">
                            <h3>${{data['total_earnings']}}</h3>
                            <p>Total Earnings</p>
                        </div>
                    </div>
                    <div class="overview-card">
                        <div class="overview-icon icon-eco"><i class="fas fa-leaf"></i></div>
                        <div class="overview-info">
                            <h3>15kg</h3>
                            <p>CO2 Saved</p>
                        </div>
                    </div>
                </div>

                <!-- 2. Upcoming Journey Card -->
                <div class="section-heading">
                    <span>Next Journey</span>
                    <a href="/ride/{{data.up_ride['id']}}">View Ticket</a> <!-- UPDATED LINK -->
                </div>

                <!-- Wrapped in A tag to make clickable -->
                <a href="/ride/{{data.up_ride['id']}}" class="journey-card">
                    <div class="journey-content">
                        <div class="journey-badges">
                            <span class="badge badge-upcoming">Upcoming</span>
                            <span class="badge badge-driver">You are Driving</span>
                        </div>
                        <div class="journey-route">
                            <span class="location-text">{{data['up_ride']['origin']}}</span>
                            <i class="fas fa-arrow-right route-arrow"></i>
                            <span class="location-text">{{data['up_ride']['destination']}}</span>
                        </div>
                        <div class="journey-meta">
                            <span><i class="far fa-calendar"></i>{{data['up_ride']['date']}}</span>
                            <span><i class="far fa-clock"></i> {{data['up_ride']['time']}}</span>
                            <span><i class="fas fa-chair"></i> {{data['up_ride']['seats_available']}}</span>
                        </div>
                    </div>
                </a>

                <!-- 3. Requests Tab Container -->
                <div class="requests-tabs-container">
                    <div class="tabs-header">
                        <button class="tab-btn active" onclick="switchTab('incoming')">Incoming Requests (2)</button>
                        <button class="tab-btn" onclick="switchTab('sent')">My Sent Requests</button>
                    </div>

                    <!-- Tab Content: Incoming Requests (For Drivers) -->
                    <div id="tab-incoming" class="tab-content active">
                        <div class="request-list">
                            <!-- Request 1 -->
                            {% for booking in data.ride_requests %}
                            <div class="request-card" id={{booking.id}}>
                                <!-- Added link to ride details in header -->
                                <a href="/" class="request-main" style="text-decoration: none; color: inherit;">
                                    <div class="req-user-info">
                                        <img src="https://i.pravatar.cc/150?img=5" alt="User" class="req-avatar">
                                        <div class="req-text">
                                            <h4>{{booking.user.name}}</h4>
                                            <p>{{booking.user.ratings}} â˜… Rating</p>
                                        </div>
                                    </div>
                                </a>
                                <!-- NEW: Trip Details Block -->
                                <div class="req-trip-details">
                                    <div class="req-route">
                                        {{booking.ride.origin}} <i class="fas fa-long-arrow-alt-right req-arrow"></i> {{booking.ride.destination}}
                                    </div>
                                    <div class="req-meta" data-value = {{booking.seats_requested}}>
                                        <span>Requested {{booking.seats_requested}} seat</span>
                                        <span><i class="fas fa-clock" style="font-size: 11px; margin-right: 3px;"></i> {{booking.ride.date}}</span>
                                    </div>
                                </div>

                                <div class="request-actions" data-value ={{booking.id}}>
                                    <button class="btn-accept" onclick="handleRequest('{{booking.id}}', 'accepted')">Accept</button>
                                    <button class="btn-reject" onclick="handleRequest('{{booking.id}}', 'rejected')">Reject</button>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>


                    <!-- Tab Content: My Sent Requests (For Passengers) -->
                    <div id="tab-sent" class="tab-content">
                        <div class="my-requests-list">
                            <!-- Wrapped in A tag -->
                            {% for request in data.sent_requests %}
                            <a href="/ride/{{request.ride.id}}" class="my-request-item">
                                <div class="my-req-details">
                                    <h5>To {{request.ride.destination}}</h5>
                                    <p>Waiting for {{request.owner.name}}</p>
                                </div>
                                <span class="req-status status-pending">Pending</span>
                            </a>
                            {% endfor %}
                            <!-- Wrapped in A tag -->
                            <a href="ride_detail.html" class="my-request-item">
                                <div class="my-req-details">
                                    <h5>To Washington DC</h5>
                                    <p>James B.</p>
                                </div>
                                <span class="req-status status-accepted">Accepted</span>
                            </a>
                        </div>
                    </div>
                </div>

            </div>

            <!-- === RIGHT COLUMN (Side Panel) === -->
            <div class="dash-right">

                <!-- 4. Summary Insights -->
                <div class="section-heading" style="margin-top: 0;">
                    <span>Activity Insights</span>
                </div>
                <div class="insights-card">
                    <p style="font-size: 13px; color: #6B7280; margin-bottom: 10px;">Rides per Month</p>
                    <div class="insight-bars">
                        <div class="bar-group">
                            <div class="bar" style="height: 40%;"></div><span class="bar-label">Aug</span>
                        </div>
                        <div class="bar-group">
                            <div class="bar" style="height: 60%;"></div><span class="bar-label">Sep</span>
                        </div>
                        <div class="bar-group">
                            <div class="bar active" style="height: 85%;"></div><span class="bar-label">Oct</span>
                        </div>
                        <div class="bar-group">
                            <div class="bar" style="height: 50%;"></div><span class="bar-label">Nov</span>
                        </div>
                    </div>
                </div>

                <!-- 5. Recent History -->
                <div class="section-heading">
                    <span>Recent Rides</span>
                    <a href="#">View All</a>
                </div>
                <div class="history-list">
                    <!-- Wrapped in A tag -->
                     {% for record in data.records %}
                    <a href="ride_detail.html" class="ride-history-item">
                        <div class="history-date">
                            <span class="h-day">{{record.ride.date}}</span>
                            <span class="h-month">{{record.ride.date}}</span>
                        </div>
                        <div class="history-route">
                            <h5>{{record.ride.origin}} -> {{record.ride.destination}}</h5>
                            {% if current_user == record.owner %}
                                <p> Driver</p>
                            {% else %}
                                <p> Passenger </p>
                            {% endif %}
                        </div>
                        <span class="history-status status-completed">{{record.status}}</span>
                    </a>
                        {% endfor %}
                    <a href="ride_detail.html" class="ride-history-item">
                        <div class="history-date">
                            <span class="h-day">08</span>
                            <span class="h-month">Nov</span>
                        </div>
                        <div class="history-route">
                            <h5>Boston -> NY</h5>
                            <p>Driver</p>
                        </div>
                        <span class="history-status status-completed">Completed</span>
                    </a>

                    <a href="ride_detail.html" class="ride-history-item">
                        <div class="history-date">
                            <span class="h-day">01</span>
                            <span class="h-month">Nov</span>
                        </div>
                        <div class="history-route">
                            <h5>NY -> DC</h5>
                            <p>Passenger</p>
                        </div>
                        <span class="history-status status-cancelled">Cancelled</span>
                    </a>
                </div>

            </div>

        </div>
    </div>

   
</div>
{% endblock %}
<!-- </html> -->